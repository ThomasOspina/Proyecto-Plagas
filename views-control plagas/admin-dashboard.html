<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin - Control de Plagas</title>
    <link rel="stylesheet" href="admin-dashboard.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <div class="navbar">
      <button class="toggle-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <h1>Dashboard de Administración</h1>
    </div>

    <div class="container">
      <nav class="sidebar" id="sidebar">
        <ul>
          <li>
            <a href="#agregar-usuario" onclick="mostrarSeccion('form-section')"
              ><i class="fas fa-user-plus"></i> Agregar Usuario</a
            >
          </li>
          <li>
            <a
              href="#estadisticas"
              onclick="mostrarSeccion('statistics-section')"
              ><i class="fas fa-chart-line"></i> Estadísticas de Plagas</a
            >
          </li>
          <li>
            <a href="#usuarios" onclick="mostrarSeccion('users-section')"
              ><i class="fas fa-users"></i> Usuarios</a
            >
          </li>
          <li>
            <a
              href="#configuracion"
              onclick="mostrarSeccion('settings-section')"
              ><i class="fas fa-cog"></i> Configuración</a
            >
          </li>
        </ul>
      </nav>

      <div class="content">
        <section class="form-section">
          <h2>Agregar Usuario</h2>
          <form id="userForm" onsubmit="agregarUsuario(); return false;">
            <input type="text" id="nombreInput" placeholder="Nombre" required />
            <input type="email" id="emailInput" placeholder="Email" required />
            <input type="text" id="cedulaInput" placeholder="Cédula" required />
            <input
              type="password"
              id="passwordInput"
              placeholder="Contraseña"
              required
            />
            <select id="rolInput" class="role-select" required>
              <option value="" disabled selected>Selecciona un rol</option>
              <option value="Admin">Admin</option>
              <option value="Técnico">Técnico</option>
            </select>
            <button type="submit">Agregar Usuario</button>
          </form>
        </section>

        <section class="statistics-section" style="display: none">
          <h2>Estadísticas de Plagas</h2>
          <canvas id="plagasChart"></canvas>
          <p>
            Comparación con el año anterior: Este año se reportaron un total de
            10% menos de plagas en comparación con 2023, lo que refleja una
            mejora en el control y manejo de las plagas.
          </p>
        </section>

        <section class="users-section" style="display: none">
          <h2>Usuarios</h2>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Cédula</th>
                <th>Rol</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
          </table>
        </section>

        <section class="settings-section" style="display: none">
          <h2>Configuración</h2>
          <form id="settingsForm" onsubmit="guardarConfiguracion(event)">
            <fieldset>
              <legend>Cambiar Contraseña</legend>
              <label for="password">Nueva Contraseña:</label>
              <input
                type="password"
                id="password"
                placeholder="Nueva Contraseña"
                required
                minlength="8"
              />
              <span class="password-requirements"
                >La contraseña debe tener al menos 8 caracteres.</span
              >
            </fieldset>

            <fieldset>
              <legend>Notificaciones</legend>
              <label for="notifications">Notificaciones:</label>
              <select id="notifications">
                <option value="enabled">Habilitadas</option>
                <option value="disabled">Deshabilitadas</option>
              </select>
            </fieldset>

            <fieldset>
              <legend>Idioma</legend>
              <label for="language">Selecciona un idioma:</label>
              <select id="language">
                <option value="es">Español</option>
                <option value="en">Inglés</option>
              </select>
            </fieldset>

            <fieldset>
              <legend>Tema</legend>
              <label for="theme">Selecciona un tema:</label>
              <select id="theme">
                <option value="light">Claro</option>
                <option value="dark">Oscuro</option>
              </select>
            </fieldset>

            <button type="submit">Guardar Configuración</button>
            <p id="feedback" style="display: none"></p>
          </form>
        </section>
      </div>
    </div>

    <script>
      let usuarios = [
        {
          id: 1,
          nombre: "Juan Pérez",
          email: "juan@example.com",
          cedula: "1234567890",
          password: "contraseña1",
          rol: "Admin",
        },
        {
          id: 2,
          nombre: "María López",
          email: "maria@example.com",
          cedula: "2345678901",
          password: "contraseña2",
          rol: "Técnico",
        },
      ];

      const plagasData = {
        labels: [
          "Enero",
          "Febrero",
          "Marzo",
          "Abril",
          "Mayo",
          "Junio",
          "Julio",
          "Agosto",
          "Septiembre",
          "Octubre",
          "Noviembre",
          "Diciembre",
        ],
        datasets: [
          {
            label: "Plagas Reportadas",
            data: [10, 15, 5, 20, 25, 30, 10, 5, 15, 20],
            backgroundColor: "rgba(125, 180, 54, 0.2)",
            borderColor: "rgb(125, 180, 54)",
            borderWidth: 1,
          },
        ],
      };

      const config = {
        type: "line",
        data: plagasData,
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } },
        },
      };

      const plagasChart = new Chart(
        document.getElementById("plagasChart"),
        config
      );

      function cargarUsuarios() {
        const userTableBody = document.getElementById("userTableBody");
        userTableBody.innerHTML = "";
        usuarios.forEach((usuario) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${usuario.id}</td>
                    <td>${usuario.nombre}</td>
                    <td>${usuario.email}</td>
                    <td>${usuario.cedula}</td>
                    <td>
                        <select class="role-select" onchange="cambiarRol(${
                          usuario.id
                        }, this.value)">
                            <option value="Admin" ${
                              usuario.rol === "Admin" ? "selected" : ""
                            }>Admin</option>
                            <option value="Técnico" ${
                              usuario.rol === "Técnico" ? "selected" : ""
                            }>Técnico</option>
                        </select>
                    </td>
                    <td><button onclick="eliminarUsuario(${
                      usuario.id
                    })">Eliminar</button></td>
                `;
          userTableBody.appendChild(row);
        });
      }

      function agregarUsuario() {
        const nombre = document.getElementById("nombreInput").value;
        const email = document.getElementById("emailInput").value;
        const cedula = document.getElementById("cedulaInput").value;
        const password = document.getElementById("passwordInput").value;
        const rol = document.getElementById("rolInput").value;

        if (nombre && email && cedula && password && rol) {
          const nuevoUsuario = {
            id: usuarios.length + 1,
            nombre,
            email,
            cedula,
            password,
            rol,
          };
          usuarios.push(nuevoUsuario);
          cargarUsuarios();
          document.getElementById("userForm").reset();
        } else {
          alert("Por favor, completa todos los campos.");
        }
      }

      function cambiarRol(id, nuevoRol) {
        const usuario = usuarios.find((u) => u.id === id);
        if (usuario) {
          usuario.rol = nuevoRol;
          alert(`Rol de ${usuario.nombre} cambiado a ${nuevoRol}`);
        }
      }

      function eliminarUsuario(id) {
        const index = usuarios.findIndex((u) => u.id === id);
        if (index !== -1) {
          const usuarioEliminado = usuarios[index];
          usuarios.splice(index, 1);
          cargarUsuarios();
          alert(`Usuario ${usuarioEliminado.nombre} eliminado`);
        }
      }

      function mostrarSeccion(seccion) {
        document.querySelectorAll(".content > section").forEach((section) => {
          section.style.display = "none";
        });
        document.querySelector(`.${seccion}`).style.display = "block";
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("active");
      }

      function guardarConfiguracion(event) {
        event.preventDefault(); // Evita el envío del formulario
        const password = document.getElementById("password").value;
        const notifications = document.getElementById("notifications").value;
        const language = document.getElementById("language").value;
        const theme = document.getElementById("theme").value;

        // Aquí puedes agregar lógica para guardar la configuración

        // Feedback al usuario
        const feedback = document.getElementById("feedback");
        feedback.innerText = "Configuración guardada con éxito.";
        feedback.style.display = "block";

        // Limpiar el formulario si es necesario
        document.getElementById("settingsForm").reset();
      }

      cargarUsuarios();
    </script>
  </body>
</html>
